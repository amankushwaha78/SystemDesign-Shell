<!--
====================================================================================================
4ï¸âƒ£ SERVICE LAYER & INSTANCE SELECTION
====================================================================================================

ðŸ“Œ PURPOSE OF THIS STAGE
----------------------------------------------------------------------------------------------------
Process the business logic and decide:
ðŸ‘‰ Which INSTANCE of a service should handle the request?

This stage happens AFTER:
âœ” DNS resolution
âœ” L4 Load Balancer
âœ” API Gateway / L7 Routing

====================================================================================================
ðŸ“ WHERE SERVICE LAYER EXISTS
====================================================================================================

âœ” Inside the selected region
âœ” Behind API Gateway / L7 Load Balancer
âœ” Usually runs as:
  - VMs
  - Containers (Docker)
  - Pods (Kubernetes)

Examples:
- Order Service
- Payment Service
- User Service

====================================================================================================
ðŸ§  WHAT ARRIVES AT THIS STAGE
====================================================================================================

âœ” Fully decrypted HTTP request
âœ” Already authenticated & authorized
âœ” Already routed to correct SERVICE

Example:
--------
/cosmos/orders â†’ Cosmos Order Service

====================================================================================================
â“ QUESTION THIS STAGE ANSWERS
====================================================================================================

ðŸ‘‰ Which INSTANCE of this service should process the request?

====================================================================================================
ðŸ“Œ HOW SERVICE INSTANCE IS CHOSEN
====================================================================================================

1ï¸âƒ£ ROUND ROBIN
--------------
- Request goes to next instance in order

--------------------------------------------------

2ï¸âƒ£ LEAST LOADED
----------------
- Instance with lowest CPU / memory / requests

--------------------------------------------------

3ï¸âƒ£ SESSION AFFINITY (OPTIONAL)
-------------------------------
- Same user â†’ same instance
- Used when stateful behavior is needed

--------------------------------------------------

4ï¸âƒ£ HEALTH CHECK FILTERING
-------------------------
âŒ Unhealthy instance removed
âœ” Only healthy instances receive traffic

====================================================================================================
ðŸ“Š SERVICE INSTANCE SELECTION FLOW
====================================================================================================

Request enters service pool
        â†“
Filter healthy instances
        â†“
Apply selection strategy
        â†“
Choose ONE instance
        â†“
Execute business logic

====================================================================================================
ðŸ§  WHAT SERVICE LAYER DOES
====================================================================================================

âœ” Executes business logic
âœ” Calls databases
âœ” Calls other services
âœ” Produces events / messages (optional)

====================================================================================================
ðŸ§  WHAT SERVICE LAYER DOES NOT DO
====================================================================================================

âŒ Does NOT choose region
âŒ Does NOT handle TLS termination
âŒ Does NOT perform global routing

====================================================================================================
ðŸ§  FINAL MEMORY TRICK
====================================================================================================

DNS  â†’ WHERE (region)
L4   â†’ WHICH connection
L7   â†’ WHICH service
SVC  â†’ WHICH instance   â† YOU ARE HERE

====================================================================================================
ðŸŽ¤ INTERVIEW-SAFE ONE-LINER
====================================================================================================

â€œAfter routing through the API gateway, the service layer selects a healthy instance
using strategies like round-robin or least-loaded and executes the core business logic.â€

====================================================================================================
END OF SERVICE LAYER STAGE
====================================================================================================
-->
