<!--
====================================================================================================
3ï¸âƒ£ API GATEWAY / L7 LOAD BALANCER (APPLICATION ROUTING STAGE)
====================================================================================================

ðŸ“Œ PURPOSE OF THIS STAGE
----------------------------------------------------------------------------------------------------
Handle HTTP/HTTPS traffic and make APPLICATION-LEVEL decisions such as:
- Which service should handle the request?
- Is the request allowed?
- Should the request be routed, blocked, or rate-limited?

This stage works ONLY after:
âœ” DNS resolution
âœ” TCP connection handling by L4 Load Balancer

====================================================================================================
ðŸ“ WHERE API GATEWAY EXISTS
====================================================================================================

API Gateway / L7 Load Balancer exists:
-------------------------------------
âœ” Inside the selected REGION
âœ” After L4 Load Balancer
âœ” At the HTTP entry point of the system

Common implementations:
-----------------------
- AWS ALB / API Gateway
- Azure Application Gateway
- GCP HTTP(S) Load Balancer
- NGINX / Envoy / HAProxy

ðŸ‘‰ API Gateway â‰ˆ L7 Load Balancer

====================================================================================================
ðŸ§  WHAT ARRIVES AT THIS STAGE
====================================================================================================

At this point:
--------------
âœ” TCP connection already established
âœ” TLS handshake completed (HTTPS)
âœ” Full HTTP request is available

Example HTTP request:
---------------------
GET /cosmos/orders
Headers:
- Authorization: Bearer token
- Content-Type: application/json

====================================================================================================
â“ QUESTIONS API GATEWAY ANSWERS
====================================================================================================

ðŸ‘‰ Which SERVICE should handle this request?
ðŸ‘‰ Is the request AUTHORIZED?
ðŸ‘‰ Has the client exceeded RATE LIMITS?
ðŸ‘‰ Should this request be BLOCKED or ALLOWED?

====================================================================================================
ðŸš¦ WHAT API GATEWAY DOES
====================================================================================================

âœ” Terminates HTTPS (SSL/TLS)
âœ” Inspects HTTP request
âœ” Applies routing rules
âœ” Applies security policies
âœ” Forwards request to correct service pool

====================================================================================================
ðŸ“Œ HOW API GATEWAY ROUTES REQUESTS
====================================================================================================

1ï¸âƒ£ PATH-BASED ROUTING
---------------------
/cosmos   â†’ Cosmos Service
/refserve â†’ Refserve Service
/know     â†’ Know Service

--------------------------------------------------

2ï¸âƒ£ HOST-BASED ROUTING
---------------------
api.goq.com   â†’ API Service
admin.goq.com â†’ Admin Service

--------------------------------------------------

3ï¸âƒ£ HEADER-BASED ROUTING
-----------------------
- Canary releases
- A/B testing
- Version routing

--------------------------------------------------

4ï¸âƒ£ METHOD-BASED ROUTING
-----------------------
GET  â†’ Read service
POST â†’ Write service

====================================================================================================
ðŸ›¡ï¸ SECURITY AT API GATEWAY
====================================================================================================

API Gateway can enforce:
------------------------
âœ” Authentication (JWT, OAuth)
âœ” Authorization
âœ” Rate limiting
âœ” Request validation

âš ï¸ WAF is usually ATTACHED here
- Inspects payload for attacks
- Blocks malicious requests

====================================================================================================
ðŸ“Š API GATEWAY DECISION FLOW
====================================================================================================

HTTP Request
     â†“
TLS Termination
     â†“
Authentication & Authorization
     â†“
Rate Limiting / WAF checks
     â†“
Routing Rule Match
     â†“
Forward to Target Service Pool

====================================================================================================
ðŸ§  WHAT API GATEWAY DOES NOT DO
====================================================================================================

âŒ Does NOT choose region
âŒ Does NOT balance raw TCP connections
âŒ Does NOT execute business logic
âŒ Does NOT store application data

====================================================================================================
ðŸ” WHAT HAPPENS AFTER THIS STAGE
====================================================================================================

Once service is chosen:
-----------------------
âœ” Request is forwarded to the appropriate application service
âœ” Service-level load balancing takes over
âœ” Business logic executes

ðŸ‘‰ Next stage:
**Service / Application Layer**

====================================================================================================
ðŸ§  FINAL MEMORY TRICK
====================================================================================================

DNS  â†’ WHERE (region)
L4   â†’ WHICH connection
L7   â†’ WHICH service   â† API Gateway
APP  â†’ WHAT logic

====================================================================================================
ðŸŽ¤ INTERVIEW-SAFE ONE-LINER
====================================================================================================

â€œAfter traffic is distributed by the L4 load balancer, it reaches the API Gateway or L7 load
balancer, which performs HTTP-level routing, security checks, and forwards the request to the
appropriate application service.â€
-->


<!-- 
ðŸ“Œ TLS TERMINATION (SHORT NOTES) :
--------------------------------

TLS termination = decrypting HTTPS at a gateway/load balancerso the request can be read and processed.

WHY IT IS NEEDED:
-----------------
- HTTPS traffic is encrypted
- Components like API Gateway / L7 Load Balancer must:
  âœ” Read URL
  âœ” Read headers
  âœ” THan Apply routing & security rules

WHERE TLS TERMINATION HAPPENS:
------------------------------
âœ” API Gateway
âœ” L7 Load Balancer
âœ” WAF (attached to L7)

âŒ L4 Load Balancer does NOT terminate TLS

HOW IT WORKS (SIMPLE FLOW):
---------------------------
Client (HTTPS ðŸ”’)
   â†“
API Gateway / L7 LB  â† TLS terminated here
   â†“
Backend Service (HTTP or re-encrypted HTTPS)

TWO COMMON PATTERNS:
--------------------
1ï¸âƒ£ TLS Termination Only
   - Gateway decrypts
   - Backend receives HTTP
   - Faster, common

2ï¸âƒ£ TLS Termination + Re-Encryption
   - Gateway decrypts
   - Gateway re-encrypts to backend
   - Used for high-security systems

KEY TAKEAWAY:
-------------
ðŸ‘‰ Any component that needs to inspect HTTP
ðŸ‘‰ must terminate TLS

INTERVIEW ONE-LINER:
--------------------
â€œTLS termination is the process of decrypting HTTPS traffic at an API gateway or L7 load balancer so the request can be inspected and routed.â€
